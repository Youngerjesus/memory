## TCP vs UDP 

***

#### Transport Layer

신뢰성 있는 데이터 전송을 담당하는 계층 

이 레이어가 없다면 어떻게 되는가 

- 데이터 순차 전송이 안된다.

- Flow 문제가 생긴다 - 송수신자간의 데이터 처리 속도 차이 때문에 일어나는 문제 

  - 송신자는 수신자한테 데이터를 보내는데 수신자는 이 데이터를 처리하는 속도가 느리다. 그러면 데이터를 잘 받기 힘든 문제
  
- Congestion 문제가 생긴다 (네트워크 레벨 즉 라우터에서 유실되는 문제가 생긴다)

#### TCP(Transmission Control Protocol)

- 신뢰성있는 데이터 통신을 가능하게 해주는 프로토콜 
  
  - 신뢰성있는 데이터 전송이란 송신자가 처리할 수 있느 속도에 맞춰서 보내는 Flow Control
  
    - 이를 위한 기법으로 Sliding Window 를 사용한다. 이 이전 기법에는 송신자는 데이터를 하나씩 순서대로 보내고 수신자는
    하나씩 받고 잘 받았다 응답을 해줘야 송신자가 이어서 보내는 방식을 사용했는데 이는 효율적이지 않다.
    
    - 그래서 Sliding Window 가 나왔는데 수신자 측에서 설정한 윈도우 크기만큼 한번에 송신자가 보내고 그 중 유실한게 있다면 
    그 부분을 달라고 수신자가 요청하고 다 받았으면 다 받았다고 하는 부분  
  
  - 네트워크 상에 있는 라우터에 과도한 부담을 주지 않기 위한 Congestion Control 
  
    - ATMD(Additive Increase Multicast Decrease)
    
      - 처음에 패킷 하나씩 보내면서 간을 보다가 패킷이 잘 도착하면 패킷을 하나씩 더 추가로 보내는 기법이다. 
        
      - 그러다가 Congestion 이 검출되면 현재 보내는 패킷의 사이즈를 절반으로 줄이고 다시 보낸다.
      
      - 매우 공평한 알고리즘이지만 늦게 네트워크에 도달하는 쪽이 일정 규모 이상의 패킷을 보내기 전까지 시간이
      많이 걸린다는 단점이 있다.  
      
    - Slow Start 
    
      - ATMD 를 좀 보완한 형태로 어떤 임계치 까지는 패킷을 성공적으로 보내면 두배씩 늘려서 보내는 방식이다.
      
      - 임계치까지 도달하면 패킷을 이제 두배씩 올리는게 아니라 1씩 증가싴면서 올린다. 
      
      - Fast Recovery 를 사용하면 혼잡 상태가 났을 때 보내는 패킷의 사이즈를 절반으로 줄이지만 
      이를 사용하지 않으면 패킷의 개수를 1로 줄인다.
        
  - 데이터의 유실을 체크하고 다시 보내도록 해주는 Error Detection 
  
    - 데이터 오류 프레임을 발견하면 다시 재전송 해달라는 NAK 를 보내거나 
    
    - 데이터의 순서에 맞지 않도록 오면 다시 보내달라는 요청을 하거나
    
    - 송신자가 데이터를 보내고 나서 ACK 가 오지 않아 타임아웃이 발생한 경우에 재전송 하는 경우   
    
- Connection 연결을 위해 3 way-handshake 가 일어나고                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         4-way-handshake 과정을 통해 연결을 해제한다. 

- 순차 전송 

- Flow Control

- Congestion Control 

- Error Detection 

- TCP 의 데이터 전송단위는 세그먼트로 데이터에 TCP 헤더를 붙인다. 


#### Connection Handshake
1. SYN 플래그를 통해서 커넥션 연결 시작 

2. SYN 플래그와 함께 ACK 플래그를 통해 패킷 송신

3. ACK 비트를 1로 설정해서 패킷을 송신한다.  

#### Connection Close Handshake
 
1. 데이터를 전부 수신한 Client 가 연결을 종료하는 FIN 을 보낸다. 

2. 서버가 ACK 를 보낸다.

3. 서버에서 남은 패킷을 모두 보낸다. 

4. 서버가 FIN 송신한다.

5. 클라이언트가 ACK 를 보낸다. 

#### UDP

TCP 와는 다르게 연결을 맺지 않는다

데이터 전달을 보장해주지도 않고 순서도 보장해주지 않는다. 하지만 빠르다. 

IP와 거의 유사한데 전달하는 PORT 와 체크섬 정도만 추가된다.  

데이터를 보내는 속도는 빠르지만 신뢰성있는 전달은 해주지 않는다.

주로 RTP(Real Time Protocol) 이나 Multicast, DNS 등에서 사용한다. 

 

