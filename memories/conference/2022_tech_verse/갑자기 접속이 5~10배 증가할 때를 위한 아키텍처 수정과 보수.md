# 갑자기 접속이 5~10배 증가할 때를 위한 아키텍처 수정과 보수

https://www.youtube.com/watch?v=PUThSNMR61M

***

시스템의 부하가 갑자기 증가했을 떄 생기는 어려움을 다룸. 
- 아키텍처 관점에서
- 안정화 유지보수
- 인프라 비용 절감 측면에서 다룸.


잘못된 시스템 아키텍처로 부하를 견딜려면 클라우드 환경에선 엄청난 비용이 나올 수 있다.

대략 트래픽에 대해서도 알고 있어야한다. 그리고 얼마나 트래픽이 증가하는지에 대해서도 알고 있어야함.

캐시를 쓰지 않는다면, 샤딩을하고 Replication 도 하고 그럤는데도 비용 효율적이지 않을 수 있다.

많이 접근하는 데이터는 캐시로 올려야함. 가벼운 데이터 같은 경우는 local cache 를 써도 괜찮다.
- local cache 의 경우 중복이 생긴다 라는 걸 알자. (pod 별로.) 
- 읽기 전용이면 더 좋다. 
- 업데이트를 어떻게 할 지 중요
  - 동시성을 고려하면서 아토믹하게 업데이트 되는걸 고려.
  - 데이터 부정합이 일어나지 않도록.
  - Redis 에 트랜잭션 기능이 있긴하다.
    - 롤백처리나 에러 핸들링이 어렵다. 클라이언트를 고려하면서 처리하는 건 어렵다.
  - 그래서 Redis Module 을 고려했다는듯.
    - Redis Lua Script vs Module
    - Module 이 C언어로 되어있어서 더 빠르다.
    - Atomic 한 트랜잭션을 지원하기 위해서 씀.


User 의 Action 에 대한 히스토리를 모두 기록하네. ㄷㄷ

Redis 를 이용할 때 안쓰는 불필요한 데이터까지 참조하게 되면 비효율적이라서 이를 개선했다.
- Hash 타입을 써서 분류했다. 


Redis 를 쓸때도 데이터 사이즈가 크다면 압축을 고려하네.


AWS RDBMS 에서 집계처리를 하는 것에서 S3 로 옮겼다.
- 이게 더 비용 효율적
- RDBMS 는 I/O 작업에 따라 요금을 매김
- 그리고 RDBMS 에서 집계처리를 하면 서비스 하고 있는 데이터베이스에 영향을 준다.
- 최종 결과만 RDBMS 에 반영하는 걸로.
