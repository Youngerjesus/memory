## 정규화 

***

### 정규화란?

정규화는데이터베이스 설계를 평가하는 척도 같은 것 설계를 잘못하면 중복으로 데이터가 들어가는 경우가 생길 수 있고 이상현상이 생길 수 있다.

### 이상 현상이란?

- 삽입 이상: 새 데이터를 삽입하기 위해 불필요한 데이터까지 넣는 문제

- 갱신 이상: 중복 튜플 중 일부만 데이터 변경을 해서 데이터 정합성이 꺠지는 현상 

- 삭제 이상: 투플을 삭제하면 꼭 필요한 데이터까지 함께 삭제되는 현상


#### 이상 현상이 있는 예시 데이터 - 고객 이벤트 참여 릴레이션  

| 고객 아이디 | 이벤트 번호 | 당첨 여부 | 고객 이름 | 등급 |
| :---------: | :---------: | :-------: | :-------: | :--: |
|    apple    |    E001     |     N     |  정소희   | GOLD |
|    apple    |    E005     |     N     |  정소희   | GOLD |
|    apple    |    E010     |     Y     |  정소의   | GOLD |

- 삽입 이상: 이 이벤트 참여 릴레이션은 한 고객은 여러 이벤트에 참여가 가능하다. 그러면 여러번 참여한다고 하면 고객과 관련된 데이터는 여러번 중복되야 한다. 즉 삽입 이상 현상이 있다. 

- 갱신 이상: 이 이벤트 참여 릴레이션에는 한 고객이 여러 이벤트에 참여가 가능하고 섞여 있다. 만약에 고객 등급이 GOLD 에서 VIP 로 올라간다면 다른 데이터와 일치하지 않는 정합성 문제가 생긴다. 즉 여러번 수정해줘야 하는 문제가 생긴다. 

- 삭제 이상: 이 이벤트 참여 릴레이션에서 한 고객의 이벤트 참여를 취소하려고 하면 데이터를 삭제해야한다. 하지만 이 경우에 관련없는 데이터까지 지우는 문제가 생긴다. 여기 케이스의 경우에는 이벤트 참여 데이터를 지울려고 하지만 고객 관련 데이터도 지우므로. 

***
    
### 함수 종속성이란? 

이런 정규화를 알기 위해서는 함수 종속성을 알아야 한다. 

함수 종속성은 하나의 값이 다른 하나의 값을 결정하는 기준을 말한다. 고객 아이디가 결정되면 고객 이름도 결정되는 것.

***
 
### 정규화 종류

#### 제1 정규형

- 릴레이션에 속한 모든 칼럼이 Atomic 한 값이어야 한다. 이 특징은 관계형 데이터베이스 릴레이션의 가장 기본적인 조건이다. 
  
#### 제2 정규형

- 제1 정규형에 속하면서 기본키가 아닌 모든 속성들이 기본키에 종속되어야 한다. 
  
##### 고객 릴레이션

| 고객 아이디 |  등급  | 할인율 |
| :---------: | :----: | :----: |
|    apple    |  gold  |  10%   |
|   banana    |  vip   |  20%   |
|   orange    | silver |   5%   |


##### 이벤트 참여 릴레이션 

| 고객 아이디 | 이벤트 번호 | 당첨여부 |
| :---------: | :---------: | :------: |
|    apple    |    E001     |    N     |
|   banana    |    E004     |    N     |
|   oragne    |    E009     |    Y     |

- 제2 정규형이라도 고객 릴레이션은 함수 종속성이 여러개 있으므로 이상 현상이 생길 수 있다. (할인율 -> 등급 -> 고객아이디 이런식으로 종속성이 있음.)

  - 삽입 이상: 그러므로 새로운 등급과 할인율을 추가하기 위해서는 고객 아이디가 항상 있어야 함.
  
  - 갱신 이상: 등급에 대한 할인율을 수정하면 모든 등급과 할인율을 수정해줘야 함 안그러면 정합성 문제가 생김.
  
  - 삭제 이상: 필요없는 등급과 할인율을 제거할려면 고객아이디도 함께 지워야 하는 이상현상이 생김
  

#### 제3 정규형

제2 정규형을 만족하면서 기본 키에 대한 함수 이행 종속성이 있으면 안됨.

##### 이행적 함수 종속성이란 

X -> Y -> Z 이기 때문에 X -> Z 에 종속되는 걸 말함. 

##### 고객 릴레이션 
| 고객 아이디 |  등급  |
| :---------: | :----: |
|    apple    |  gold  |
|   banana    |  vip   |
|   orange    | silver |


##### 등급 릴레이션 

| 등급 |  할인율  |
| :---------: | :----: |
|    gold    |  10%  |
|   vip    |  20%   |
|   silver    | 5% | 


#### 보이스/코드 정규형

릴레이션의 함수 종속 관계에서 모든 결정자가 후보키이면 보이스코드 정규형에 속한다.
 
##### 후보키란?

기본키가 될 수 있는 부분집합을 말한다. 

##### 고객 인터넷 강좌 신청 릴레이션 

한 고객은 여러개의 인터넷 강좌를 신청할 수 있고 중복 신청은 안된다. 

인터넷 강좌는 여러 담당 강사가 있을 수 있다. 

| 고객 아이디 | 인터넷 강좌 | 담당 강사 번호 |
| :---------: | :---------: | :------------: |
|    apple    |  영어회화   |      P001      |
|   banana    |  기초토익   |      P002      |
|   carrot    |  기초토익   |      P004      |
|   carrot    |  영어회화   |      P001      |



여기서 기본키는 (고객 아이디, 인터넷 강좌) 가 될 수 있고 (고객 아이디, 담당 강사 번호)가 될 수 있다. 

만약 첫번째로 결정을 하게 된다면 담당 강사 번호가 결정자 후보키가 아님에도 불구하고 결정자가 될 수 있다. 

- 삽입 이상: 여기서 한 강사의 강의 정보를 넣을려면 고객에 대한 정보를 넣어줘야 한다. 

- 갱신 이상: 한 강사의 강의 정보를 바꿀려면 모든 강의 정보를 바꿔줘야 정합성이 꺠지지 않는다.

- 삭제 이상: 한 강사의 강의 정보를 없앨려면 고객 아이디 까지도 없애야 한다. 
  
#### 제4 정규형과 제5 정규형 

여기부터는 고급 정규형에 속한다. 제4 정규형은 다차 종속에 속하면 안되고 제5 정규형은 조인 종속성에 속하면 안된다. 

제5까지 쓰면 효율성이 안나오므로 이까지 가진 않는다. 





  