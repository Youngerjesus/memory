## Index 

#### 인덱스를 사용하는 이유 

전체 테이블의 크기는 데이터 블록의 수에 의존히는데 테이블 풀 스캔을 하면 이 모든 데이터 블록을 가지고 오게 된다. 그 경우 I/O 작업이
많으니까 성능이 안나오게 되지만 인덱스를 사용하면 RowId 에 필요한 데이터블록에 대한 정보가 있으므로 가지고 올 데이터 블록의 개수가 줄어들게 된다. 

#### B-Tree 인덱스
 
- Root Node

- Branch Node

- Leaf Node

  - 인덱스 칼럼이 정렬된 상태로 되어 있고 데이터 저장 주소인 RowId 가 저장되어 있다. 
  
    - RowId: Object, Block, File, Row
  
#### 인덱스 사용 예 
  
- 인덱스를 이용하면 정렬되어 있으므로 Range Scan 을 통한 실행을 할 때 order By 절을 대신할 수 있다. 그리고 최대나 최소 값을 통한 조뢰흘 할 때 유용하다. 

#### 인덱스 스캔의 원리

1. 인덱스 칼럼을 따라서 Leaf 노드를 찾고 여기에 있는 RowId 를 통해서 필요한 데이터 블록을 알게 되고 이를 통한 처리를한다.

2. Leaf 노드는 링크드 리스트로 연결되어 있으니까 조건에 따라서 다음 노드를 찾을 수 있고 거기에 있는 RowId 를 통해서 또 다시 필요한 데이터 블록을 가지고 오도록 해서 
이를 처리한다. 

#### Question 

1. 모든 쿼리들은 인덱스를 사용하는게 올바른가? 

- 일반적으로 인덱스는 테이블에 있는 전체 데이터 중에서 10% ~ 15% 미만에 있는 찾기 힘든 데이터를 처리할 때 효과적이다. 

#### 인덱스 선정 기준

- 분포도가 좋은 칼럼
  
  - Cardinality 와 연관된 칼

- 자주 조홥되서 사용되는 칼럼

- 수정이 빈번하지 않은 칼럼

- Foreign Key 로 사용되는 칼럼

- MIN 또는 MAX 값을 자주 구하는 칼럼 이나 정렬 기준으로 사용되는 칼럼 (인덱스를 사용하면 기본적으로 정렬이 되니)  

#### 인덱스를 사용하지 못하는 경우

- NOT 연산자 

  - `WHERE empno != 7900`
  
  - `WHERE empno NOT IN (7777,8888)`
  
  - `WHERE job NOT LIKE `SALES%` ` 
  
- IS_NULL 이나 IS_NOT_NULL

  - B-Tree 인덱스는 NULL 값을 저장하지 않기 때문에 

  - `WHERE empno IS_NULL`
  
  - `WHERE empno IS_NOT_NULL`
  
- External suppressing

  - External suppressing 는 인덱스 칼럼의 변형을 말한다.
  
  - `WHERE SUBSTR(ename, 1, 1) =- `J` `
  
    - 인덱스 칼럼을 SUBSTR() 이라는 함수로 변형 시킨 걸 말한다. 
  
  - `WHERE depno || job = `30SALESMAN` `
  
    - 인덱스 칼럼을 || 연산자로 연결시킨 걸 말한다. 
    
- Internal suppressing 

  - Internal suppressing 은 데이터 타입이 안맞을 때 인덱스는 사용되지 않는다 라는 의미다. 
  
  - `WHERE empno LIKE `78%` `
  
  - `WHERE depno = 30`
  
#### 결합 인덱스의 사용 

결합 인덱스를 사요하는 예는 다음과 같다. 

- WHERE 절에서 AND 조건으로 자주 묶이는 경우가 많고 이때 분포도가 좋다면 이 칼럼들을 결합해서 다중 칼럼 인덱스로 사용하는 경우가 있다.

  - 급여_인덱스가 있다고 할 때 이걸 (연월, 급여코드, 사원번호)를 이용해서 만들 수 있다.  이 경우에 가장 왼쪽에 있는 칼럼은 무조건 사용해야 결합 인덱스를 사용하는게 가능하다. 
  
- 다른 테이블과 조인을 위한 연결고리로 사용되는 칼럼의 경우에 인덱스로 사용할 수 있다. 

결합 인덱스는 왼쪽에 있는 칼럼이 중요하다. 이런 칼럼의 선별 기준은 다음과 같다. 

- Where 절에서 가장 빈번하게 사용되는 칼럼을 찾는다. (범위를 좁히는데 사용한다.) 

- 두번째는 주로 `=` 를 많이 사용하는 칼럼을 찾는다. (범위를 좁히기 보다는 찾는 용도로 사용한다. 이 말은 스캔을 종료하는 범위를 말한다.)

- 세번째 기준은 분포도가 좋은 칼럼을 우선으로 한다. 

- 좀 더 생각하자면 자주 이용되는 order_by 절의 순서를 반영하는게 좋다.

  
#### Index Skip Scanning

- 결합 인덱스를 사용하는데 첫번째 조건이 범위를 좁히는데 적합하지 않거나 Where 절에서 첫번째 칼럼이 제외되어 있는 경우에 첫번째 칼럼을 건너뛰고 인덱스 스캔을
하는 걸 말한다. 

- `INDEX SS (table 명, idx 명) `


#### Index Only Scan 

인덱스 온리 스캔은 인덱스를 사용하는 칼럼만 이용해서 스캔을 하는 방식으로 테이블 스캔을 하지 않는 방법을 말한다.

인덱스 자체가 테이블의 부분집합이니까 총 스캔할 대상이 적다는게 가장 큰 특징이다.

원래 인덱스는 Where 절을 통한 데이터 압축을 하지 않으면 인덱스를 사용하지 않는데 쿼리할 대상의 필드가 
인덱스 칼럼만 있다면 인덱스 만을 이용한 스캔을 옵티마이저가 하게 된다.

이러한 인덱스를 커버링 인덱스(Covering Index) 라고 한다.    

